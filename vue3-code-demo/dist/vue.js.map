{"version":3,"file":"vue.js","sources":["../src/reactivity/computed.ts","../src/reactivity/effect.ts","../src/shared/index.ts","../src/reactivity/baseHandlers.ts","../src/reactivity/reactive.ts","../src/reactivity/ref.ts"],"sourcesContent":["/*\n * @Author: 鲍佳玮\n * @Date: 2022-01-28 20:28:54\n * @LastEditors: 鲍佳玮\n * @LastEditTime: 2022-01-28 20:31:33\n * @Description: computed\n */\nexport function computed() {}\n","/*\n * @Author: 鲍佳玮\n * @Date: 2022-01-28 20:29:26\n * @LastEditors: 鲍佳玮\n * @LastEditTime: 2022-01-29 00:17:13\n * @Description: effect\n */\nexport function effect(fn, options: any = {}) {\n  const effect = createReactiveEffect(fn, options) // 创建一个响应式的effect\n  if (!options.lazy) {\n    effect()\n  }\n  return effect\n}\nlet activeEffect // 全局变量，用于存储当前的effect，关联每个get的state属性\nlet uid = 0\nconst effectStack = [] // 建立一个effect栈，用于处理嵌套effect，但是effect被清空导致后面的属性无法被收集\nfunction createReactiveEffect(fn, options) {\n  const effect = function () {\n    try {\n      activeEffect = effect\n      effectStack.push(activeEffect)\n      return fn() // 内部调用用户传入effect的方法\n    } finally {\n      effectStack.pop()\n      activeEffect = effectStack[effectStack.length - 1]\n    }\n  }\n  effect.id = uid++\n  effect.deps = [] // 用于创建每个effect和state的联系\n  effect.options = options\n  return effect\n}\nconst targetMap = new WeakMap()\n// 将属性和effect关联,此方法在baseHandlers的get里用到，\n// 因为执行fn后，会一次调用proxy的get方法。需要在get的时候\n// 将目标函数和属性传入\n// 由于effect可以多次调用\n// 所以关联结构应为{Object:{key: [effect,effect]}}\nexport function track(target, key) {\n  if (activeEffect == null) {\n    //如果用户不在effect里取值，直接return\n    return\n  }\n  // start =====处理map空的情况=====\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()))\n  }\n  // end =====处理map空的情况=====\n  // 创建每个属性和effect的联系，这个联系是双向的\n  if (!dep.has(activeEffect)) {\n    dep.add(activeEffect)\n    activeEffect.deps.push(dep)\n  }\n}\n","/*\n * @Author: 鲍佳玮\n * @Date: 2022-01-28 21:05:13\n * @LastEditors: 鲍佳玮\n * @LastEditTime: 2022-01-28 21:47:30\n * @Description: 工具\n */\nexport const isObject = val => typeof val === 'object' && val != null\nexport const isSymbol = val => typeof val === 'symbol'\nexport const isArray = val => Array.isArray\nexport const isInteger = key => '' + parseInt(key, 10) === key\nconst hasOwnProperty = Object.prototype.hasOwnProperty\nexport const hasOwn = (val, key) => hasOwnProperty.call(val, key)\nexport const hasChanged = (value, oldValue) => value !== oldValue\n","import { hasChanged, hasOwn, isArray, isInteger, isObject, isSymbol } from '../shared/index'\nimport { track } from './effect'\nimport { reactive } from './reactive'\n\nfunction createGetter() {\n  return function get(target, key, receiver) {\n    const res = Reflect.get(target, key, receiver)\n    if (isSymbol(key)) {\n      return res\n    }\n    // 依赖收集\n    track(target, key)\n    if (isObject(res)) {\n      // 取值是对象就代理，懒递归\n      return reactive(res)\n    }\n    return res\n  }\n}\nfunction createSetter() {\n  return function set(target, key, value, receiver) {\n    const oldValue = target[key]\n    const hadKey = isArray(target) && isInteger(key) ? Number(key) < target.length : hasOwn(target, key)\n    const result = Reflect.set(target, key, value, receiver)\n    if (!hadKey) {\n      console.log('新增属性')\n    } else if (hasChanged(value, oldValue)) {\n      console.log('修改属性')\n    }\n    return result\n  }\n}\nconst get = createGetter()\nconst set = createSetter()\nexport const mutableHandlers = {\n  get,\n  set\n}\n","import { isObject } from '../shared/index'\nimport { mutableHandlers } from './baseHandlers'\n\n/*\n * @Author: 鲍佳玮\n * @Date: 2022-01-28 20:29:13\n * @LastEditors: 鲍佳玮\n * @LastEditTime: 2022-01-28 21:11:36\n * @Description: reactive\n */\n\nexport function reactive(target) {\n  return createReactiveObject(target, mutableHandlers)\n}\nconst proxyMap = new WeakMap()\nfunction createReactiveObject(target, baseHandlers) {\n  //不是对象不做代理\n  if (!isObject(target)) {\n    return target\n  }\n  const exisitingProxy = proxyMap.get(target)\n  if (exisitingProxy) {\n    return exisitingProxy\n  }\n  const proxy = new Proxy(target, baseHandlers)\n  // 做缓存，将代理过的对象和代理后的结果做一个映射表\n  proxyMap.set(target, proxy)\n  return proxy\n}\n","/*\n * @Author: 鲍佳玮\n * @Date: 2022-01-28 20:30:55\n * @LastEditors: 鲍佳玮\n * @LastEditTime: 2022-01-28 20:32:06\n * @Description: ref\n */\nexport function ref() {}\n"],"names":[],"mappings":";;;;;;EAAA;;;;;;;WAOgB,QAAQ;;ECPxB;;;;;;;WAOgB,MAAM,CAAC,EAAE,EAAE,OAAiB;MAAjB,wBAAA,EAAA,YAAiB;MAC1C,IAAM,MAAM,GAAG,oBAAoB,CAAC,EAAE,EAAE,OAAO,CAAC,CAAA;MAChD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;UACjB,MAAM,EAAE,CAAA;OACT;MACD,OAAO,MAAM,CAAA;EACf,CAAC;EACD,IAAI,YAAY,CAAA;EAChB,IAAI,GAAG,GAAG,CAAC,CAAA;EACX,IAAM,WAAW,GAAG,EAAE,CAAA;EACtB,SAAS,oBAAoB,CAAC,EAAE,EAAE,OAAO;MACvC,IAAM,MAAM,GAAG;UACb,IAAI;cACF,YAAY,GAAG,MAAM,CAAA;cACrB,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAA;cAC9B,OAAO,EAAE,EAAE,CAAA;WACZ;kBAAS;cACR,WAAW,CAAC,GAAG,EAAE,CAAA;cACjB,YAAY,GAAG,WAAW,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,CAAA;WACnD;OACF,CAAA;MACD,MAAM,CAAC,EAAE,GAAG,GAAG,EAAE,CAAA;MACjB,MAAM,CAAC,IAAI,GAAG,EAAE,CAAA;MAChB,MAAM,CAAC,OAAO,GAAG,OAAO,CAAA;MACxB,OAAO,MAAM,CAAA;EACf,CAAC;EACD,IAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAA;EAC/B;EACA;EACA;EACA;EACA;WACgB,KAAK,CAAC,MAAM,EAAE,GAAG;MAC/B,IAAI,YAAY,IAAI,IAAI,EAAE;;UAExB,OAAM;OACP;;MAED,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;MACnC,IAAI,CAAC,OAAO,EAAE;UACZ,SAAS,CAAC,GAAG,CAAC,MAAM,GAAG,OAAO,GAAG,IAAI,GAAG,EAAE,EAAE,CAAA;OAC7C;MACD,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;MAC1B,IAAI,CAAC,GAAG,EAAE;UACR,OAAO,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,EAAE,EAAE,CAAA;OACpC;;;MAGD,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE;UAC1B,GAAG,CAAC,GAAG,CAAC,YAAY,CAAC,CAAA;UACrB,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;OAC5B;EACH;;EC3DA;;;;;;;EAOO,IAAM,QAAQ,GAAG,UAAA,GAAG,IAAI,OAAA,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,IAAI,IAAI,GAAA,CAAA;EAC9D,IAAM,QAAQ,GAAG,UAAA,GAAG,IAAI,OAAA,OAAO,GAAG,KAAK,QAAQ,GAAA,CAAA;EAC/C,IAAM,OAAO,GAAG,UAAA,GAAG,IAAI,OAAA,KAAK,CAAC,OAAO,GAAA,CAAA;EACpC,IAAM,SAAS,GAAG,UAAA,GAAG,IAAI,OAAA,EAAE,GAAG,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,KAAK,GAAG,GAAA,CAAA;EAC9D,IAAM,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC,cAAc,CAAA;EAC/C,IAAM,MAAM,GAAG,UAAC,GAAG,EAAE,GAAG,IAAK,OAAA,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,GAAA,CAAA;EAC1D,IAAM,UAAU,GAAG,UAAC,KAAK,EAAE,QAAQ,IAAK,OAAA,KAAK,KAAK,QAAQ,GAAA;;ECTjE,SAAS,YAAY;MACnB,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ;UACvC,IAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;UAC9C,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;cACjB,OAAO,GAAG,CAAA;WACX;;UAED,KAAK,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;UAClB,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;;cAEjB,OAAO,QAAQ,CAAC,GAAG,CAAC,CAAA;WACrB;UACD,OAAO,GAAG,CAAA;OACX,CAAA;EACH,CAAC;EACD,SAAS,YAAY;MACnB,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ;UAC9C,IAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;UAC5B,IAAM,MAAM,GAAG,OAAO,CAAO,CAAC,IAAI,SAAS,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;UACpG,IAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAA;UACxD,IAAI,CAAC,MAAM,EAAE;cACX,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;WACpB;eAAM,IAAI,UAAU,CAAC,KAAK,EAAE,QAAQ,CAAC,EAAE;cACtC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;WACpB;UACD,OAAO,MAAM,CAAA;OACd,CAAA;EACH,CAAC;EACD,IAAM,GAAG,GAAG,YAAY,EAAE,CAAA;EAC1B,IAAM,GAAG,GAAG,YAAY,EAAE,CAAA;EACnB,IAAM,eAAe,GAAG;MAC7B,GAAG,KAAA;MACH,GAAG,KAAA;GACJ;;EClCD;;;;;;;WAQgB,QAAQ,CAAC,MAAM;MAC7B,OAAO,oBAAoB,CAAC,MAAM,EAAE,eAAe,CAAC,CAAA;EACtD,CAAC;EACD,IAAM,QAAQ,GAAG,IAAI,OAAO,EAAE,CAAA;EAC9B,SAAS,oBAAoB,CAAC,MAAM,EAAE,YAAY;;MAEhD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;UACrB,OAAO,MAAM,CAAA;OACd;MACD,IAAM,cAAc,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;MAC3C,IAAI,cAAc,EAAE;UAClB,OAAO,cAAc,CAAA;OACtB;MACD,IAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,YAAY,CAAC,CAAA;;MAE7C,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;MAC3B,OAAO,KAAK,CAAA;EACd;;EC5BA;;;;;;;WAOgB,GAAG;;;;;;;;;;;;;"}